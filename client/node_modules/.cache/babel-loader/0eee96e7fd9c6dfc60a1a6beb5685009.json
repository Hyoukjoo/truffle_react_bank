{"ast":null,"code":"var Blockchain = {\n  getBlockByNumber: function getBlockByNumber(blockNumber, provider, callback) {\n    var params = [blockNumber, true];\n    provider.send({\n      jsonrpc: '2.0',\n      method: 'eth_getBlockByNumber',\n      params: params,\n      id: Date.now()\n    }, callback);\n  },\n  getBlockByHash: function getBlockByHash(blockHash, provider, callback) {\n    var params = [blockHash, true];\n    provider.send({\n      jsonrpc: '2.0',\n      method: 'eth_getBlockByHash',\n      params: params,\n      id: Date.now()\n    }, callback);\n  },\n  parse: function parse(uri) {\n    var parsed = {};\n    if (uri.indexOf(\"blockchain://\") != 0) return parsed;\n    uri = uri.replace(\"blockchain://\", \"\");\n    var pieces = uri.split(\"/block/\");\n    parsed.genesis_hash = \"0x\" + pieces[0];\n    parsed.block_hash = \"0x\" + pieces[1];\n    return parsed;\n  },\n  asURI: function asURI(provider, callback) {\n    var self = this;\n    var genesis;\n    self.getBlockByNumber(\"0x0\", provider, function (err, response) {\n      if (err) return callback(err);\n      genesis = response.result;\n      self.getBlockByNumber(\"latest\", provider, function (err, response) {\n        if (err) return callback(err);\n        latest = response.result;\n        var url = \"blockchain://\" + genesis.hash.replace(\"0x\", \"\") + \"/block/\" + latest.hash.replace(\"0x\", \"\");\n        callback(null, url);\n      });\n    });\n  },\n  matches: function matches(uri, provider, callback) {\n    var self = this;\n    uri = self.parse(uri);\n    var expected_genesis = uri.genesis_hash;\n    var expected_block = uri.block_hash;\n    self.getBlockByNumber(\"0x0\", provider, function (err, response) {\n      if (err) return callback(err);\n      var block = response.result;\n      if (block.hash != expected_genesis) return callback(null, false);\n      self.getBlockByHash(expected_block, provider, function (err, response) {\n        // Treat an error as if the block didn't exist. This is because\n        // some clients respond differently.\n        var block = response.result;\n\n        if (err || block == null) {\n          return callback(null, false);\n        }\n\n        callback(null, true);\n      });\n    });\n  }\n};\nmodule.exports = Blockchain;","map":null,"metadata":{},"sourceType":"script"}